<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elden Ring Items</title>
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div id="app">
      <h1>Objetos de Elden Ring</h1>

      <div class="product-selection">
        <div
          v-for="(product, index) in products"
          :key="index"
          class="product-item"
        >
          <img :src="product.image" alt="Product Image" />
          <h3>{{ product.name }}</h3>
          <p class="description">{{ product.description }}</p>
          <p class="price">Precio: {{ product.price.toFixed(2) }} €</p>
          <input
            type="number"
            v-model="product.quantity"
            min="1"
            placeholder="Quantity"
          />
          <button @click="addToCart(product, product.quantity)">
            Add to Cart
          </button>
        </div>
      </div>

      <div class="cart-sidebar" v-if="cart.length > 0">
        <h2>Carro de la Compra</h2>
        <ul>
          <li v-for="(item, index) in cart" :key="index">
            {{ item.name }} - €{{ item.price.toFixed(2) }}
            <input
              type="number"
              v-model="item.quantity"
              @input="updateQuantity(index)"
            />
            <button @click="removeFromCart(index)">Remove</button>
          </li>
        </ul>
        <p>Total: {{ calculateTotal().toFixed(2) }} €</p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script>
      new Vue({
        el: "#app",
        data() {
          return {
            products: [],
            cart: [],
          };
        },
        methods: {
          async fetchProducts() {
            try {
              const response = await fetch(
                "https://eldenring.fanapis.com/api/items?limit=36"
              );
              const data = await response.json();

              if (data.success) {
                this.products = data.data.map((product) => ({
                  ...product,
                  price: Math.random() * (100 - 10) + 10,
                  quantity: 1,
                }));
              } else {
                console.error("Failed to fetch products:", data.error);
              }
            } catch (error) {
              console.error("Error fetching products:", error);
            }
          },
          addToCart(product, quantity) {
            const existingItem = this.cart.find(
              (item) => item.name === product.name
            );

            if (existingItem) {
              existingItem.quantity += +quantity; // Convert quantity to a number
            } else {
              this.cart.push({
                name: product.name,
                price: product.price,
                quantity: +quantity,
              });
            }
          },

          removeFromCart(index) {
            this.cart.splice(index, 1);
          },
          updateQuantity(index) {
            if (this.cart[index].quantity < 1) {
              this.cart[index].quantity = 1;
            }
          },
          calculateTotal() {
            return this.cart.reduce(
              (total, item) => total + item.price * item.quantity,
              0
            );
          },
        },
        mounted() {
          this.fetchProducts();
        },
      });
    </script>
  </body>
</html>
